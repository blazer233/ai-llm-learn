# è„šæœ¬ä½¿ç”¨æŒ‡å—

> è¯¦ç»†çš„è„šæœ¬åŠŸèƒ½è¯´æ˜å’Œä½¿ç”¨æ–¹æ³•

## ğŸ“ è„šæœ¬ç›®å½•

æ‰€æœ‰è„šæœ¬ä½äº `scripts/` ç›®å½•ä¸‹ï¼š

```
scripts/
â”œâ”€â”€ setup_and_train.sh      # ä¸€é”®å®‰è£…å’Œè®­ç»ƒ
â”œâ”€â”€ monitor_training.sh     # ç›‘æ§è®­ç»ƒè¿›åº¦
â”œâ”€â”€ pause_training.sh       # æš‚åœè®­ç»ƒ
â”œâ”€â”€ resume_training.sh      # æ¢å¤è®­ç»ƒ
â””â”€â”€ start_training.sh       # å¯åŠ¨è®­ç»ƒï¼ˆæ—§ç‰ˆï¼‰
```

---

## ğŸ”§ è„šæœ¬è¯¦è§£

### 1. `setup_and_train.sh` - ä¸€é”®å®‰è£…å’Œè®­ç»ƒ

**åŠŸèƒ½**: è‡ªåŠ¨åŒ–å®Œæˆç¯å¢ƒé…ç½®å’Œè®­ç»ƒå¯åŠ¨

**æ‰§è¡Œæµç¨‹**:
1. æ£€æŸ¥ Python ç¯å¢ƒï¼ˆä¼˜å…ˆä½¿ç”¨ Python 3.11ï¼‰
2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ `train_env/`
3. å®‰è£…ä¾èµ–åŒ…ï¼ˆtorch, transformers, peft, datasets, accelerateï¼‰
4. å¯åŠ¨è®­ç»ƒè„šæœ¬ `simple_train.py`

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd /Users/songyanchao/Desktop/thing/zhishi/finetune
./scripts/setup_and_train.sh
```

**è¾“å‡ºç¤ºä¾‹**:
```
======================================
CSS åŠ©æ‰‹æ¨¡å‹å¾®è°ƒ - è‡ªåŠ¨åŒ–è„šæœ¬
======================================

[1/4] æ£€æŸ¥ Python ç¯å¢ƒ...
âœ“ ä½¿ç”¨ Python: Python 3.11.12

[2/4] åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ...
âœ“ è™šæ‹Ÿç¯å¢ƒåˆ›å»ºå®Œæˆ

[3/4] å®‰è£…ä¾èµ–åŒ…...
âœ“ ä¾èµ–å®‰è£…å®Œæˆ

[4/4] å¼€å§‹è®­ç»ƒ...
```

**æ³¨æ„äº‹é¡¹**:
- é¦–æ¬¡è¿è¡Œéœ€è¦ä¸‹è½½æ¨¡å‹ï¼ˆçº¦ 6GBï¼‰ï¼Œéœ€è¦ç½‘ç»œè¿æ¥
- å®‰è£…ä¾èµ–å¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿ
- è®­ç»ƒä¼šåœ¨å‰å°è¿è¡Œï¼Œå…³é—­ç»ˆç«¯ä¼šä¸­æ–­è®­ç»ƒ

---

### 2. `monitor_training.sh` - ç›‘æ§è®­ç»ƒè¿›åº¦

**åŠŸèƒ½**: å®æ—¶æŸ¥çœ‹è®­ç»ƒçŠ¶æ€å’Œè¿›åº¦

**æ£€æŸ¥å†…å®¹**:
- è®­ç»ƒè¿›ç¨‹æ˜¯å¦è¿è¡Œ
- CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ
- è¿è¡Œæ—¶é•¿
- å·²ä¿å­˜çš„ checkpoints
- æ¨¡å‹è¾“å‡ºæ–‡ä»¶

**ä½¿ç”¨æ–¹æ³•**:
```bash
./scripts/monitor_training.sh
```

**è¾“å‡ºç¤ºä¾‹**:
```
======================================
è®­ç»ƒç›‘æ§
======================================

âœ“ è®­ç»ƒè¿›ç¨‹æ­£åœ¨è¿è¡Œ

è¿›ç¨‹ä¿¡æ¯:
  PID: 12345
  CPU: 97.3%
  å†…å­˜: 0.5%
  è¿è¡Œæ—¶é—´: 2:03.04

æ¨¡å‹è¾“å‡ºç›®å½•:
total 1024
-rw-r--r--  1 user  staff  512K Nov 11 10:30 adapter_model.safetensors

Checkpoints:
css_assistant_model/checkpoint-500
css_assistant_model/checkpoint-1000

======================================
```

**ä½¿ç”¨åœºæ™¯**:
- å®šæœŸæ£€æŸ¥è®­ç»ƒæ˜¯å¦æ­£å¸¸è¿è¡Œ
- æŸ¥çœ‹è®­ç»ƒè¿›åº¦
- ç¡®è®¤ checkpoints æ˜¯å¦æ­£å¸¸ä¿å­˜

---

### 3. `pause_training.sh` - æš‚åœè®­ç»ƒ

**åŠŸèƒ½**: å®‰å…¨åœ°åœæ­¢è®­ç»ƒè¿›ç¨‹

**æ‰§è¡Œæµç¨‹**:
1. æŸ¥æ‰¾è®­ç»ƒè¿›ç¨‹
2. æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯
3. è¯·æ±‚ç”¨æˆ·ç¡®è®¤
4. å‘é€ä¸­æ–­ä¿¡å·ï¼ˆSIGINTï¼‰
5. ç­‰å¾…è¿›ç¨‹é€€å‡º
6. å¦‚æœæœªé€€å‡ºï¼Œå¼ºåˆ¶ç»ˆæ­¢ï¼ˆSIGKILLï¼‰
7. æ˜¾ç¤ºå·²ä¿å­˜çš„ checkpoints

**ä½¿ç”¨æ–¹æ³•**:
```bash
./scripts/pause_training.sh
```

**äº¤äº’ç¤ºä¾‹**:
```
======================================
æš‚åœè®­ç»ƒ
======================================

æ‰¾åˆ°è®­ç»ƒè¿›ç¨‹: PID 12345

è¿›ç¨‹ä¿¡æ¯:
  PID: 12345
  CPU: 97.3%
  å†…å­˜: 0.5%
  è¿è¡Œæ—¶é—´: 2:03.04

ç¡®è®¤è¦æš‚åœè®­ç»ƒå—ï¼Ÿ(y/n): y

æ­£åœ¨æš‚åœè®­ç»ƒ...
ç­‰å¾…è¿›ç¨‹å®‰å…¨é€€å‡º...
âœ“ è®­ç»ƒå·²æš‚åœ

======================================
æ£€æŸ¥ä¿å­˜çš„ Checkpoint
======================================

å·²ä¿å­˜çš„ Checkpoints:
css_assistant_model/checkpoint-500
css_assistant_model/checkpoint-1000
```

**æ³¨æ„äº‹é¡¹**:
- æš‚åœåï¼Œæœªä¿å­˜çš„è¿›åº¦ä¼šä¸¢å¤±
- å»ºè®®ç­‰åˆ°ä¿å­˜ checkpoint åå†æš‚åœï¼ˆæ¯ 500 æ­¥ï¼‰
- å¯ä»¥é€šè¿‡ `resume_training.sh` æ¢å¤è®­ç»ƒ

---

### 4. `resume_training.sh` - æ¢å¤è®­ç»ƒ

**åŠŸèƒ½**: é‡æ–°å¯åŠ¨è®­ç»ƒï¼ˆåå°è¿è¡Œï¼‰

**æ‰§è¡Œæµç¨‹**:
1. æ£€æŸ¥æ˜¯å¦æœ‰è®­ç»ƒè¿›ç¨‹åœ¨è¿è¡Œ
2. æŸ¥æ‰¾æœ€æ–°çš„ checkpoint
3. æç¤ºç”¨æˆ·ç¡®è®¤
4. åœ¨åå°å¯åŠ¨è®­ç»ƒ
5. æ—¥å¿—è¾“å‡ºåˆ° `training.log`

**ä½¿ç”¨æ–¹æ³•**:
```bash
./scripts/resume_training.sh
```

**è¾“å‡ºç¤ºä¾‹**:
```
======================================
æ¢å¤è®­ç»ƒ
======================================

âœ“ æ‰¾åˆ°æœ€æ–°çš„ Checkpoint: css_assistant_model/checkpoint-1000

âš ï¸  æ³¨æ„: å½“å‰ simple_train.py ä¸æ”¯æŒä» checkpoint æ¢å¤
   éœ€è¦ä¿®æ”¹è„šæœ¬æ·»åŠ  resume_from_checkpoint å‚æ•°

æ˜¯å¦ä»å¤´å¼€å§‹é‡æ–°è®­ç»ƒï¼Ÿ(y/n): y

å¼€å§‹è®­ç»ƒ...
======================================

âœ“ è®­ç»ƒå·²åœ¨åå°å¯åŠ¨
  è¿›ç¨‹ ID: 12345

æŸ¥çœ‹è®­ç»ƒæ—¥å¿—:
  tail -f training.log

ç›‘æ§è®­ç»ƒçŠ¶æ€:
  ./monitor_training.sh

æš‚åœè®­ç»ƒ:
  ./pause_training.sh
```

**åå°è¿è¡Œä¼˜åŠ¿**:
- å¯ä»¥å…³é—­ç»ˆç«¯çª—å£
- ä¸å½±å“å…¶ä»–å·¥ä½œ
- æ—¥å¿—ä¿å­˜åˆ°æ–‡ä»¶

**æŸ¥çœ‹æ—¥å¿—**:
```bash
# å®æ—¶æŸ¥çœ‹
tail -f training.log

# æŸ¥çœ‹æœ€å 50 è¡Œ
tail -50 training.log

# æœç´¢é”™è¯¯
grep -i error training.log
```

---

### 5. `start_training.sh` - å¯åŠ¨è®­ç»ƒï¼ˆæ—§ç‰ˆï¼‰

**åŠŸèƒ½**: ç®€å•çš„è®­ç»ƒå¯åŠ¨è„šæœ¬ï¼ˆå·²è¢« `setup_and_train.sh` æ›¿ä»£ï¼‰

**ä½¿ç”¨æ–¹æ³•**:
```bash
./scripts/start_training.sh
```

**è¯´æ˜**: 
- è¿™æ˜¯æ—©æœŸç‰ˆæœ¬çš„è„šæœ¬
- æ¨èä½¿ç”¨ `setup_and_train.sh` æˆ– `resume_training.sh`

---

## ğŸ”„ å…¸å‹å·¥ä½œæµç¨‹

### åœºæ™¯ 1: é¦–æ¬¡è®­ç»ƒ

```bash
# 1. ä¸€é”®å¯åŠ¨
./scripts/setup_and_train.sh

# 2. å®šæœŸç›‘æ§ï¼ˆå¦å¼€ç»ˆç«¯ï¼‰
./scripts/monitor_training.sh

# 3. ç­‰å¾…å®Œæˆï¼ˆ2-4 å°æ—¶ï¼‰
```

### åœºæ™¯ 2: æš‚åœå’Œæ¢å¤

```bash
# 1. æš‚åœè®­ç»ƒ
./scripts/pause_training.sh

# 2. ç¨åæ¢å¤ï¼ˆåå°è¿è¡Œï¼‰
./scripts/resume_training.sh

# 3. æŸ¥çœ‹æ—¥å¿—
tail -f training.log

# 4. ç›‘æ§çŠ¶æ€
./scripts/monitor_training.sh
```

### åœºæ™¯ 3: é•¿æ—¶é—´è®­ç»ƒ

```bash
# 1. åå°å¯åŠ¨
./scripts/resume_training.sh

# 2. å®šæœŸæ£€æŸ¥
watch -n 60 './scripts/monitor_training.sh'

# 3. æŸ¥çœ‹æ—¥å¿—
tail -f training.log
```

---

## ğŸ“Š è„šæœ¬è¾“å‡ºè¯´æ˜

### è¿›ç¨‹çŠ¶æ€
- **PID**: è¿›ç¨‹ ID
- **CPU**: CPU ä½¿ç”¨ç‡ï¼ˆæ¥è¿‘ 100% è¡¨ç¤ºæ­£å¸¸è®­ç»ƒï¼‰
- **å†…å­˜**: å†…å­˜ä½¿ç”¨ç‡
- **è¿è¡Œæ—¶é—´**: å·²è¿è¡Œæ—¶é•¿

### Checkpoint è¯´æ˜
- **checkpoint-500**: ç¬¬ 500 æ­¥çš„æ£€æŸ¥ç‚¹
- **checkpoint-1000**: ç¬¬ 1000 æ­¥çš„æ£€æŸ¥ç‚¹
- æ¯ 500 æ­¥ä¿å­˜ä¸€æ¬¡
- æœ€å¤šä¿ç•™ 3 ä¸ª checkpoint

### æ—¥å¿—æ–‡ä»¶
- **training.log**: è®­ç»ƒæ—¥å¿—ï¼ˆåå°è¿è¡Œæ—¶ï¼‰
- åŒ…å«è®­ç»ƒè¿›åº¦ã€æŸå¤±å€¼ã€å­¦ä¹ ç‡ç­‰ä¿¡æ¯

---

## âš™ï¸ è‡ªå®šä¹‰è„šæœ¬

### ä¿®æ”¹ä¿å­˜é—´éš”

ç¼–è¾‘ `simple_train.py`:
```python
SAVE_STEPS = 500  # æ”¹ä¸º 100ã€200 ç­‰
```

### ä¿®æ”¹æ‰¹æ¬¡å¤§å°

ç¼–è¾‘ `simple_train.py`:
```python
BATCH_SIZE = 4  # æ”¹ä¸º 2ã€8 ç­‰
```

### æ·»åŠ  checkpoint æ¢å¤

ç¼–è¾‘ `simple_train.py`ï¼Œåœ¨ `TrainingArguments` ä¸­æ·»åŠ :
```python
training_args = TrainingArguments(
    # ... å…¶ä»–å‚æ•°
    resume_from_checkpoint="css_assistant_model/checkpoint-1000"
)
```

---

## ğŸ› æ•…éšœæ’é™¤

### è„šæœ¬æ— æ³•æ‰§è¡Œ

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x scripts/*.sh
```

### æ‰¾ä¸åˆ° Python

```bash
# æ£€æŸ¥ Python ç‰ˆæœ¬
python3 --version
python3.11 --version

# ä¿®æ”¹è„šæœ¬ä¸­çš„ PYTHON_CMD å˜é‡
```

### è™šæ‹Ÿç¯å¢ƒé—®é¢˜

```bash
# åˆ é™¤å¹¶é‡å»º
rm -rf train_env
python3.11 -m venv train_env
```

### è¿›ç¨‹æ— æ³•åœæ­¢

```bash
# æŸ¥æ‰¾è¿›ç¨‹
ps aux | grep simple_train.py

# å¼ºåˆ¶ç»ˆæ­¢
kill -9 <PID>
```

---

## ğŸ“ è„šæœ¬ç»´æŠ¤

### å¤‡ä»½è„šæœ¬

```bash
cp -r scripts scripts_backup
```

### æ›´æ–°è„šæœ¬

```bash
# æ‹‰å–æœ€æ–°ç‰ˆæœ¬
git pull

# æˆ–æ‰‹åŠ¨ç¼–è¾‘
vim scripts/setup_and_train.sh
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](QUICK_START.md)
- [è®­ç»ƒçŠ¶æ€](TRAINING_STATUS.md)
- [ä¸» README](../README.md)

---

**è„šæœ¬è®©è®­ç»ƒæ›´ç®€å•ï¼** ğŸš€
